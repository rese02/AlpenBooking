rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    // Pfad für Hotel-Logos und Bilder
    // Das Schreiben wird erlaubt, weil die Dateinamen serverseitig
    // zufällig und sicher generiert werden, sodass niemand etwas überschreiben kann.
    // Das Lesen wird auf angemeldete Benutzer beschränkt.
    match /hotel-logos/{hotelId}/{allPaths=**} {
      allow read; // Jeder kann die Logos lesen
      allow write: if request.auth == null; // Erlaubt den Upload nur, wenn nicht authentifiziert (für die Erstellung)
    }

    match /bookings/{bookingId}/{allPaths=**} {
      // Nur ein eingeloggter Hotelier darf die Dateien lesen (herunterladen)
      allow read: if request.auth != null;
      // Jeder darf schreiben (für den Gast-Upload), ABER der Pfad wird serverseitig
      // sicher generiert, sodass Gäste nicht woanders hochladen können.
      allow write;
    }
  }
}