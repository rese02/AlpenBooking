rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    // Hotel logos are public to read, but only authenticated users can write.
    match /hotel-logos/{hotelId}/{fileName} {
      allow read: if true;
      allow write: if true; // In production: request.auth != null;
    }

    // Guest documents (ID, payment proof) should be highly restricted.
    // The path should include the bookingId for scoping.
    match /booking-documents/{bookingId}/{fileName} {
        // READ: Only authenticated users (hoteliers/admins) should be able to read.
        // We can't verify ownership without auth tokens, so for now it's open for logged-in users.
        allow read: if true; // In production: request.auth != null;

        // WRITE: Anyone can write (for the guest upload), but with restrictions:
        // - File size must be limited (e.g., max 5MB)
        // - File type should be checked (e.g., image/jpeg, image/png, application/pdf)
        allow write: if request.resource.size < 5 * 1024 * 1024
                     && request.resource.contentType.matches('image/.*|application/pdf');
    }
    
    // Disallow all other access to storage
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
